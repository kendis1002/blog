---
title: 'Tính năng mới trong phiên bản v1'
date: 2021-08-07T15:32:14Z
lastmod: '2021-02-01'
tags: ['next-js', 'tailwind', 'guide']
draft: false
summary: 'Tổng quan về các tính năng mới được phát hành trong v1 - sao chép khối mã, nhiều tác giả, bố cục frontmatter và nhiều hơn nữa'
layout: PostSimple
bibliography: references-data.bib
---

## Tổng quan

Một bài viết về các tính năng mới được giới thiệu trong v1.0. Các tính năng mới:

<TOCInline toc={props.toc} exclude="Overview" toHeading={2} />

Kích thước JS tải lần đầu giảm từ 43kB xuống 39kB mặc dù đã thêm tất cả các tính năng mới! [^1]

[^1]: Với những thay đổi mới trong Nextjs 12, kích thước JS tải lần đầu tăng lên 45kB.

Xem [hướng dẫn nâng cấp](#upgrade-guide) bên dưới nếu bạn đang chuyển từ phiên bản v0 của mẫu.

## Màu sắc chủ đề

Bạn có thể dễ dàng sửa đổi màu chủ đề bằng cách thay đổi thuộc tính primary trong tệp cấu hình tailwind:

```js:tailwind.config.js
theme: {
    colors: {
      primary: colors.teal,
      gray: colors.neutral,
      ...
    }
  ...
}
```

Thuộc tính màu primary nên được gán một đối tượng với các khóa từ 50, 100, 200 ... 900 và các giá trị mã màu tương ứng.

Tailwind bao gồm các bảng màu mặc định tuyệt vời có thể được sử dụng để tùy chỉnh trang web của bạn. Kiểm tra [trang tài liệu tùy chỉnh màu sắc](https://tailwindcss.com/docs/customizing-colors) để xem đầy đủ các tùy chọn.

Đang chuyển từ v1? Bạn có thể quay lại chủ đề trước đó bằng cách đặt `primary` thành `colors.sky` (Tailwind 2.2.2 trở lên, nếu không thì `colors.lightBlue`) và thay đổi gray thành `colors.gray`.

Từ v1.1.2 trở lên, bạn cũng có thể dễ dàng tùy chỉnh kiểu của các khối mã bằng cách sửa đổi bảng định kiểu `css/prism.css`. Tên lớp token tương thích với prismjs
nên bạn có thể sao chép và điều chỉnh kiểu token từ bảng định kiểu prismjs, ví dụ: [chủ đề prism](https://github.com/PrismJS/prism-themes).

## Trình biên dịch MDX Xdm

Chúng tôi đã chuyển bộ đóng gói MDX từ [next-mdx-remote](https://github.com/hashicorp/next-mdx-remote) sang [mdx-bundler](https://github.com/kentcdodds/mdx-bundler).
Điều này sử dụng [xdm](https://github.com/wooorm/xdm) bên dưới, micromark 3 mới nhất và các thư viện remark, rehype.

**Cảnh báo:** Nếu bạn đang sử dụng các thư viện remark hoặc rehype tùy chỉnh, vui lòng nâng cấp lên các phiên bản tương thích với micromark 3. Nếu bạn đang nâng cấp, vui lòng xóa `node_modules` và `package-lock.json` để tránh các vấn đề liên quan đến phụ thuộc cũ.

[xdm](https://github.com/wooorm/xdm) chứa nhiều cải tiến so với [@mdx-js/mdx](https://github.com/mdx-js/mdx), trình biên dịch được sử dụng nội bộ bởi next-mdx-remote, nhưng có thể có một số thay đổi hành vi gây ra lỗi.
Vui lòng kiểm tra đầu ra markdown của bạn để xác minh.

Một số khả năng mới bao gồm tải các thành phần trực tiếp trong tệp mdx bằng cú pháp import và bao gồm mã js có thể được biên dịch và đóng gói ở bước build.

Ví dụ, đoạn jsx sau có thể được sử dụng trực tiếp trong tệp MDX để hiển thị thành phần tiêu đề trang:

```jsx
// Hoặc import PageTitle from './components/PageTitle.js' nếu bạn đang sử dụng js
import PageTitle from './components/PageTitle.tsx'
;<PageTitle> Sử dụng các thành phần JSX trong MDX </PageTitle>
```

Cấu hình mặc định giải quyết tất cả các thành phần tương đối với thư mục `components`.

**Lưu ý**:
Các thành phần yêu cầu bộ tải hình ảnh bên ngoài cũng yêu cầu cấu hình esbuild bổ sung.
Các thành phần phụ thuộc vào trạng thái ứng dụng toàn cục trong vòng đời như thành phần `Link` của Nextjs cũng sẽ không hoạt động với thiết lập này vì mỗi tệp mdx được xây dựng độc lập.
Đối với các trường hợp như vậy, tốt hơn là sử dụng thay thế thành phần.

## Thành phần mục lục

Lấy cảm hứng từ [Docusaurus](https://docusaurus.io/docs/next/markdown-features/inline-toc) và [gatsby-remark-table-of-contents](https://www.gatsbyjs.com/plugins/gatsby-remark-table-of-contents/) của Gatsby,
biến `toc` chứa tất cả các tiêu đề cấp cao nhất của tài liệu được truyền vào tệp MDX và có thể được định kiểu tương ứng.
Để tạo mục lục (TOC) đơn giản, bạn có thể sử dụng thành phần `TOCInline` hiện có.

Ví dụ, TOC trong bài viết này được tạo bằng mã sau:

```jsx
<TOCInline toc={props.toc} exclude="Overview" toHeading={2} />
```

Bạn có thể tùy chỉnh các tiêu đề được hiển thị bằng cách cấu hình các thuộc tính `fromHeading` và `toHeading`, hoặc loại trừ các tiêu đề cụ thể
bằng cách truyền một chuỗi hoặc một mảng chuỗi vào thuộc tính `exclude`. Theo mặc định, tất cả các tiêu đề có độ sâu 3 hoặc nhỏ hơn được thụt lề. Điều này có thể được cấu hình bằng cách thay đổi thuộc tính `indentDepth`.
Thuộc tính `asDisclosure` có thể được sử dụng để hiển thị TOC trong một phần tử disclosure có thể mở rộng.

Đây là TOC đầy đủ được hiển thị trong một phần tử disclosure.

```jsx
<TOCInline toc={props.toc} asDisclosure />
```

<TOCInline toc={props.toc} asDisclosure />

## Bố cục

Bạn có thể ánh xạ nội dung blog mdx vào các thành phần bố cục bằng cách cấu hình trường frontmatter. Ví dụ, bài viết này được viết với bố cục `PostSimple` mới!

### Thêm mẫu mới

Các mẫu bố cục được lưu trữ trong thư mục `./layouts`. Bạn có thể thêm các thành phần React mà bạn muốn ánh xạ vào nội dung markdown trong thư mục này.
Tên tệp thành phần phải khớp với tên được chỉ định trong trường `layout` của frontmatter markdown.

Trường bắt buộc duy nhất là `children` chứa nội dung MDX đã được hiển thị, mặc dù bạn có thể muốn truyền vào nội dung frontMatter và hiển thị nó trong mẫu.

Bạn có thể cấu hình mẫu để nhận các trường khác - xem thành phần `PostLayout` để biết ví dụ.

Đây là một ví dụ về bố cục mà bạn có thể tùy chỉnh thêm:

```jsx
export default function ExampleLayout({ frontMatter, children }) {
  const { date, title } = frontMatter

  return (
    <SectionContainer>
      <div>{date}</div>
      <h1>{title}</h1>
      <div>{children}</div>
    </SectionContainer>
  )
}
```

### Cấu hình frontmatter của bài viết blog

Sử dụng trường frontmatter `layout` để chỉ định mẫu bạn muốn ánh xạ bài viết markdown vào. Đây là cách frontmatter của bài viết này trông như thế nào:

```
---
title: 'Tính năng mới trong phiên bản v1'
date: '2021-05-26   '
tags: ['next-js', 'tailwind', 'guide']
draft: false
summary: 'Giới thiệu các tính năng bố cục mới - bạn có thể ánh xạ nội dung blog mdx vào các thành phần bố cục bằng cách cấu hình trường frontmatter'
layout: PostSimple
---
```

Bạn có thể cấu hình bố cục mặc định trong phần trang tương ứng bằng cách sửa đổi biến `DEFAULT_LAYOUT`.
`DEFAULT_LAYOUT` cho trang bài viết blog được đặt thành `PostLayout`.

### Mở rộng

`layout` được ánh xạ đến wrapper bao bọc toàn bộ nội dung MDX.

```jsx
export const MDXComponents = {
  Image,
  a: CustomLink,
  pre: Pre,
  wrapper: ({ components, layout, ...rest }) => {
    const Layout = require(`../layouts/${layout}`).default
    return <Layout {...rest} />
  },
}

export const MDXLayoutRenderer = ({ layout, mdxSource, ...rest }) => {
  const MDXLayout = useMemo(() => getMDXComponent(mdxSource), [mdxSource])

  return <MDXLayout layout={layout} components={MDXComponents} {...rest} />
}
```

Sử dụng thành phần `MDXLayoutRenderer` trên một trang nơi bạn muốn chấp nhận tên bố cục để ánh xạ vào bố cục mong muốn.
Bạn cần truyền tên bố cục từ thư mục layout (nó phải khớp chính xác).

## Phân tích

Mẫu hiện hỗ trợ [plausible](https://plausible.io/), [simple analytics](https://simpleanalytics.com/) và google analytics.
Cấu hình `siteMetadata.js` với các cài đặt tương ứng với nhà cung cấp phân tích mong muốn.

```js
analytics: {
    // hỗ trợ plausible, simpleAnalytics hoặc googleAnalytics
    plausibleDataDomain: '', // ví dụ: tailwind-nextjs-starter-blog.vercel.app
    simpleAnalytics: false, // true hoặc false
    googleAnalyticsId: '', // ví dụ: UA-000000-2 hoặc G-XXXXXXX
  },
```

Các sự kiện tùy chỉnh cũng được hỗ trợ. Bạn có thể nhập hàm `logEvent` từ tệp `@components/analytics/[ANALYTICS-PROVIDER]` và gọi nó khi
kích hoạt các sự kiện quan tâm. _Lưu ý_: Có thể cần cấu hình bổ sung tùy thuộc vào nhà cung cấp phân tích, vui lòng kiểm tra tài liệu chính thức
của họ để biết thêm thông tin.

## Hệ thống bình luận blog

Chúng tôi cũng đã thêm hỗ trợ cho [giscus](https://github.com/laymonage/giscus), [utterances](https://github.com/utterance/utterances) hoặc disqus.
Để kích hoạt, chỉ cần cấu hình thuộc tính comments của `siteMetadata.js` với nhà cung cấp mong muốn và các cài đặt như được chỉ định trong tệp cấu hình.

```js
comment: {
    // Chọn một nhà cung cấp và sử dụng các biến môi trường liên quan đến nó
    // https://vercel.com/docs/environment-variables
    provider: 'giscus', // các nhà cung cấp được hỗ trợ: giscus, utterances, disqus
    giscusConfig: {
      // Truy cập liên kết bên dưới và làm theo các bước trong phần 'cấu hình'
      // https://giscus.app/
      repo: process.env.NEXT_PUBLIC_GISCUS_REPO,
      repositoryId: process.env.NEXT_PUBLIC_GISCUS_REPOSITORY_ID,
      category: process.env.NEXT_PUBLIC_GISCUS_CATEGORY,
      categoryId: process.env.NEXT_PUBLIC_GISCUS_CATEGORY_ID,
      mapping: 'pathname', // supported options: pathname, url, title
      reactions: '1', // Emoji reactions: 1 = enable / 0 = disable
      // Send discussion metadata periodically to the parent window: 1 = enable / 0 = disable
      metadata: '0',
      // theme example: light, dark, dark_dimmed, dark_high_contrast
      // transparent_dark, preferred_color_scheme, custom
      theme: 'light',
      // theme when dark mode
      darkTheme: 'transparent_dark',
      // If the theme option above is set to 'custom`
      // please provide a link below to your custom theme css file.
      // example: https://giscus.app/themes/custom_example.css
      themeURL: '',
    },
    utterancesConfig: {
      // Visit the link below, and follow the steps in the 'configuration' section
      // https://utteranc.es/
      repo: process.env.NEXT_PUBLIC_UTTERANCES_REPO,
      issueTerm: '', // supported options: pathname, url, title
      label: '', // label (optional): Comment 💬
      // theme example: github-light, github-dark, preferred-color-scheme
      // github-dark-orange, icy-dark, dark-blue, photon-dark, boxy-light
      theme: '',
      // theme when dark mode
      darkTheme: '',
    },
    disqus: {
      // https://help.disqus.com/en/articles/1717111-what-s-a-shortname
      shortname: process.env.NEXT_PUBLIC_DISQUS_SHORTNAME,
    },
  },
```

## Multiple authors

Information on authors is now split from `siteMetadata.js` and stored in its own `data/authors` folder as a markdown file. Minimally, you will need to have a `default.md` file with authorship information. You can create additional files as required and the file name will be used as the reference to the author.

Here's how an author markdown file might look like:

```md:default.md
---
name: Tails Azimuth
avatar: /static/images/avatar.png
occupation: Professor of Atmospheric Science
company: Stanford University
email: address@yoursite.com
twitter: https://twitter.com/Twitter
linkedin: https://www.linkedin.com
github: https://github.com
---

A long description of yourself...
```

You can use this information in multiple places across the template. For example in the about section of the page, we grab the default author information with this line of code:

```js
const authorDetails = await getFileBySlug('authors', ['default'])
```

This is rendered in the `AuthorLayout` template.

### Multiple authors in blog post

The frontmatter of a blog post accepts an optional `authors` array field. If no field is specified, it is assumed that the default author is used. Simply pass in an array of authors to render multiple authors associated with a post.

For example, the following frontmatter will display the authors given by `data/authors/default.md` and `data/authors/sparrowhawk.md`

```yaml
title: 'My first post'
date: '2021-01-12'
draft: false
summary: 'My first post'
authors: ['default', 'sparrowhawk']
```

A demo of a multiple authors post is shown in [Introducing Tailwind Nextjs Starter Blog post](/blog/introducing-tailwind-nextjs-starter-blog).

## Copy button for code blocks

Hover over a code block and you will notice a GitHub-inspired copy button! You can modify `./components/Pre.js` to further customise it.
The component is passed to `MDXComponents` and modifies all `<pre>` blocks.

## Line highlighting and line numbers

Line highlighting and line numbers are now supported out of the box thanks to the new [rehype-prism-plus plugin](https://github.com/timlrx/rehype-prism-plus)

The following javascript code block:

```
```js {1, 3-4} showLineNumbers
var num1, num2, sum
num1 = prompt('Enter first number')
num2 = prompt('Enter second number')
sum = parseInt(num1) + parseInt(num2) // "+" means "add"
alert('Sum = ' + sum) // "+" means combine into a string
```
```

will appear as:

```js {1,3-4} showLineNumbers
var num1, num2, sum
num1 = prompt('Enter first number')
num2 = prompt('Enter second number')
sum = parseInt(num1) + parseInt(num2) // "+" means "add"
alert('Sum = ' + sum) // "+" means combine into a string
```

To modify the styles, change the following class selectors in the `prism.css` file:

```css
.code-highlight {
  @apply float-left min-w-full;
}

.code-line {
  @apply -mx-4 block border-l-4 border-opacity-0 pl-4 pr-4;
}

.code-line.inserted {
  @apply bg-green-500 bg-opacity-20;
}

.code-line.deleted {
  @apply bg-red-500 bg-opacity-20;
}

.highlight-line {
  @apply -mx-4 border-l-4 border-primary-500 bg-gray-700 bg-opacity-50;
}

.line-number::before {
  @apply -ml-2 mr-4 inline-block w-4 text-right text-gray-400;
  content: attr(line);
}
```

## Newletter component (v1.1.3)

Introduced in v1.1.3, the newsletter component gives you an easy way to build an audience. It integrates with the following providers:

- [Mailchimp](https://mailchimp.com/)
- [Buttondown](https://buttondown.email/)
- [Convertkit](https://convertkit.com/)

To use it, specify the provider which you are using in the config file and add the necessary environment variables to the `.env` file.
For more information on the required variables, check out `.env.sample.`

Two components are exported, a default `NewsletterForm` and a `BlogNewsletterForm` component, which is also passed in as an MDX component
and can be used in a blog post:

```jsx
<BlogNewsletterForm title="Like what you are reading?" />
```

<BlogNewsletterForm title="Like what you are reading?" />

The component relies on nextjs's [API routes](https://nextjs.org/docs/api-routes/introduction) which requires a server-side instance of nextjs to be setup
and is not compatible with a 100% static site export. Users should either self-host or use a compatible platform like Vercel or Netlify which supports this functionality.

A static site compatible alternative is to substitute the route in the newsletter component with a form API endpoint provider.

## Bibliography and Citations (v1.2.1)

`rehype-citation` plugin is added to the xdm processing pipeline in v1.2.1. This allows you to easily format citations and insert bibliography from an existing bibtex or CSL-json file.

For example, the following markdown code sample:

```md
Standard citation [@Nash1950]
In-text citations e.g. @Nash1951
Multiple citations [see @Nash1950; @Nash1951, page 50]

**References:**

[^ref]
```

is rendered to the following:

Standard citation [@Nash1950]  
In-text citations e.g. @Nash1951  
Multiple citations [see @Nash1950; @Nash1951, page 50]

**References:**

[^ref]

A bibliography will be inserted at the end of the document, but this can be overwritten by specifying a `[^Ref]` tag at the intended location.
The plugin uses APA citation formation, but also supports the following CSLs, 'apa', 'vancouver', 'harvard1', 'chicago', 'mla', or a path to a user-specified CSL file.

See [rehype-citation readme](https://github.com/timlrx/rehype-citation) for more information on the configuration options.

## Self-hosted font (v1.5.0)

Google font has been replaced with self-hosted font from [Fontsource](https://fontsource.org/). This gives the following [advantages](https://fontsource.org/docs/introduction):

> Self-hosting brings significant performance gains as loading fonts from hosted services, such as Google Fonts, lead to an extra (render blocking) network request. To provide perspective, for simple websites it has been seen to double visual load times.
>
> Fonts remain version locked. Google often pushes updates to their fonts without notice, which may interfere with your live production projects. Manage your fonts like any other NPM dependency.
>
> Commit to privacy. Google does track the usage of their fonts and for those who are extremely privacy concerned, self-hosting is an alternative.

This leads to a smaller font bundle and a 0.1s faster load time ([webpagetest comparison](https://www.webpagetest.org/video/compare.php?tests=220201_AiDcFH_f68a69b758454dd52d8e67493fdef7da,220201_BiDcMC_bf2d53f14483814ba61e794311dfa771)).

To change the default Inter font:

1. Install the preferred [font](https://fontsource.org/fonts) - `npm install -save @fontsource/<font-name>`
2. Update the import at `pages/_app.js`- `import '@fontsource/<font-name>.css'`
3. Update the `fontfamily` property in the tailwind css config file

## Upgrade guide

There are significant portions of the code that has been changed from v0 to v1 including support for layouts and a new mdx engine.

There's also no real reason to change if the previous one serves your needs and it might be easier to copy
the component changes you are interested in to your existing blog rather than migrating everything over.

Nonetheless, if you want to do so and have not changed much of the template, you could clone the new version and copy over the blog post over to the new template.

Another alternative would be to pull the latest template version with the following code:

```bash
git remote add template git@github.com:timlrx/tailwind-nextjs-starter-blog.git
git pull template v1 --allow-unrelated-histories
rm -rf node_modules
```

You can see an example of such a migration in this [commit](https://github.com/timlrx/timlrx.com/commit/bba1c185384fd6d5cdaac15abf802fdcff027286) for my personal blog.

v1 also uses `feed.xml` rather than `index.xml`, to avoid some build issues with Vercel. If you are migrating you should add a redirect to `next.config.js` like so:

```js
async redirects() {
  return [
    {
      source: '/:path/index.xml',
      destination: '/:path/feed.xml',
      permanent: true,
    }
  ]
}
```
